<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Añadir Cliente</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
  <style>
    :root{
      /* Paleta elegante y limpia */
      --ink:#0f241a;         /* texto principal (verde muy oscuro) */
      --ink-soft:#334155;    /* subtítulos */
      --muted:#64748b;       /* ayudas */
      --bg:#ffffff;          /* fondo */
      --field:#f5f6f8;       /* inputs */
      --field-focus:#ffffff; /* focus input */
      --border:#e6e7eb;      /* borde suave */
      --pill-bg:#edf7f1;     /* pill */
      --pill-ink:#19603a;    /* pill texto */
      --btn:#222426;         /* botón principal */
      --btn-ink:#ffffff;     /* texto botón */
      --ghost:#ffffff;       /* botón fantasma */
      --ghost-border:#dfe3e8;
      --ok:#16a34a; --warn:#f59e0b; --bad:#ef4444;
    }
    *{box-sizing:border-box;font-family:Inter,ui-sans-serif,system-ui,Segoe UI,Roboto,Arial}
    html,body{margin:0;background:var(--bg);color:var(--ink)}
    a{color:inherit}

    /* Barra superior con utilidades (búsqueda, filtros, exportar) */
    .toolbar{position:sticky;top:0;z-index:40;background:rgba(255,255,255,.92);backdrop-filter:saturate(160%) blur(8px);border-bottom:1px solid var(--border)}
    .toolbar-inner{max-width:980px;margin:0 auto;padding:10px 12px;display:flex;gap:8px;align-items:center}
    .toolbar input,.toolbar select{padding:10px 12px;border-radius:10px;border:1px solid var(--ghost-border);background:#fff;min-width:200px}
    .spacer{flex:1}
    .btn{border:0;border-radius:12px;padding:10px 14px;cursor:pointer;font-weight:600}
    .btn.ghost{background:var(--ghost);border:1px solid var(--ghost-border);}

    /* Contenedor principal */
    .wrap{max-width:980px;margin:0 auto;padding:28px 18px 60px}
    .pill{display:block;width:max-content;margin:0 auto 10px;padding:6px 12px;border-radius:999px;background:var(--pill-bg);color:var(--pill-ink);border:1px solid #cfe7d8;font-size:12px}
    h1{margin:6px 0 10px;text-align:center;font-weight:800;letter-spacing:-0.02em;color:var(--ink);
       font-size:clamp(36px,8vw,72px);line-height:1.02}
    .subtitle{text-align:center;color:var(--ink-soft);margin-bottom:8px}

    /* Selector de servicio centrado */
    .center{display:flex;justify-content:center;align-items:center;gap:10px;margin:14px 0 26px}
    .center .label{color:var(--ink-soft)}

    /* Formulario estilizado (labels a la izquierda) */
    .form{max-width:560px;margin:0 auto}
    .row{display:grid;grid-template-columns:150px 1fr;gap:12px;align-items:center;margin-bottom:12px}
    .row label{justify-self:end;color:var(--ink);font-weight:600}
    input,select,textarea{width:100%;padding:14px;border:1px solid var(--border);border-radius:14px;background:var(--field);outline:none;transition:.15s}
    input:focus,select:focus,textarea:focus{border-color:#cbd5e1;background:var(--field-focus);box-shadow:0 0 0 3px rgba(15, 23, 42, .05)}
    textarea{min-height:88px;resize:vertical}

    .actions{display:flex;justify-content:center;gap:10px;margin-top:18px}
    .btn.primary{background:var(--btn);color:var(--btn-ink)}

    .small{font-size:12px;color:var(--muted);text-align:center;margin-top:8px}
    .addserv{border:1px dashed var(--border);background:#fff;padding:8px 10px;border-radius:10px;font-size:14px}

    /* Tabla */
    table{width:100%;border-collapse:collapse;margin-top:26px}
    th,td{padding:12px;border-bottom:1px solid var(--border);font-size:14px}
    th{text-align:left;color:#334155}
    .tag{font-size:12px;padding:3px 8px;border-radius:999px;display:inline-block;border:1px solid}
    .tag.ok{color:#166534;background:#ecfdf5;border-color:#86efac}
    .tag.warn{color:#92400e;background:#fffbeb;border-color:#fde68a}
    .tag.bad{color:#7f1d1d;background:#fef2f2;border-color:#fecaca}

    @media (max-width:680px){
      .row{grid-template-columns:1fr;gap:6px}
      .row label{justify-self:start}
      .toolbar-inner{flex-wrap:wrap}
    }
  </style>
</head>
<body>
  <!-- utilidades -->
  <div class="toolbar">
    <div class="toolbar-inner">
      <input id="q" placeholder="Buscar por nombre, email o servicio…"/>
      <select id="filterEstado">
        <option value="">Todos</option>
        <option value="vigente">Vigentes</option>
        <option value="pronto">Por vencer (≤7 días)</option>
        <option value="vencida">Vencidas</option>
      </select>
      <div class="spacer"></div>
      <button class="btn ghost" id="btnExportar">Exportar JSON</button>
      <label class="btn ghost">
        Importar JSON
        <input type="file" id="importFile" accept="application/json" hidden>
      </label>
      <button class="btn ghost" id="btnBorrarTodo" title="Borra los datos locales">Borrar todo</button>
    </div>
  </div>

  <div class="wrap">
    <span class="pill">importante</span>
    <h1>Añadir Cliente</h1>

    <div class="center">
      <div class="label">Servicio</div>
      <select id="servicio" style="max-width:260px"></select>
      <button id="btnAgregarServicio" class="addserv">+ Servicio</button>
    </div>

    <div class="form">
      <div class="row">
        <label for="nombre">Nombre</label>
        <input id="nombre" placeholder="Escribe"/>
      </div>
      <div class="row">
        <label for="email">Email</label>
        <input id="email" type="email" placeholder="ej: cliente@mail.com"/>
      </div>
      <div class="row">
        <label for="telefono">Teléfono</label>
        <input id="telefono" placeholder="+51 …"/>
      </div>
      <div class="row">
        <label for="inicio">Fecha</label>
        <input id="inicio" type="date" />
      </div>
      <div class="row">
        <label for="vence">Vence</label>
        <input id="vence" type="date" />
      </div>
      <div class="row">
        <label for="categoria">Categoría</label>
        <select id="categoria">
          <option value="">Selecciona una opción</option>
          <option>Premium</option>
          <option>Estándar</option>
          <option>Básico</option>
        </select>
      </div>
      <div class="row">
        <label for="notas">Notas</label>
        <textarea id="notas" placeholder="Plan, precio, usuario, etc."></textarea>
      </div>

      <div class="actions">
        <button class="btn primary" id="btnGuardar">Agregar</button>
        <button class="btn ghost" id="btnLimpiar">Limpiar</button>
      </div>
      <div class="small" id="msg"></div>
    </div>

    <table id="tabla">
      <thead>
        <tr>
          <th>Nombre</th><th>Email</th><th>Servicio</th>
          <th>Inicio</th><th>Vence</th><th>Estado</th><th>Días</th><th></th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>

<script>
// ===== almacenamiento =====
const KEY='clientes_v3'; const KEY_SERVS='servicios_v3';
const db={
  getAll(){return JSON.parse(localStorage.getItem(KEY)||'[]')},
  saveAll(x){localStorage.setItem(KEY,JSON.stringify(x))},
  getServicios(){return JSON.parse(localStorage.getItem(KEY_SERVS)||'["ChatGPT","Gemini","YouTube","Disney"]')},
  saveServicios(x){localStorage.setItem(KEY_SERVS,JSON.stringify(x))}
};

// ===== helpers =====
const $=s=>document.querySelector(s);
const tbody=$('#tabla tbody');
const f={nombre:$('#nombre'),email:$('#email'),telefono:$('#telefono'),
servicio:$('#servicio'),inicio:$('#inicio'),vence:$('#vence'),notas:$('#notas'),
categoria:$('#categoria')};
const q=$('#q'), filterEstado=$('#filterEstado'), msg=$('#msg');
let editId=null;

function renderServicios(){
  const list=db.getServicios();
  f.servicio.innerHTML=list.map(s=>`<option value="${s}">${s}</option>`).join('');
}
renderServicios();
$('#btnAgregarServicio').onclick=()=>{
  const nombre=prompt('Nombre del nuevo servicio:');
  if(!nombre) return;
  const list=db.getServicios();
  if(!list.includes(nombre)){
    list.push(nombre); list.sort((a,b)=>a.localeCompare(b)); db.saveServicios(list);
    renderServicios(); f.servicio.value=nombre; toast('Servicio agregado ✓');
  } else { f.servicio.value=nombre; toast('Servicio ya existía'); }
};

function diasRestantes(iso){
  if(!iso) return null; const h=new Date();h.setHours(0,0,0,0);
  const d=new Date(iso); d.setHours(0,0,0,0);
  return Math.round((d-h)/(1000*60*60*24));
}
function estadoDe(vence){
  if(!vence) return ''; const d=diasRestantes(vence);
  if(d<0) return 'vencida'; if(d<=7) return 'pronto'; return 'vigente';
}

function limpiar(){ editId=null; for(const k in f){ if('value' in f[k]) f[k].value=''; } renderServicios(); msg.textContent=''; }
$('#btnLimpiar').onclick=limpiar;

$('#btnGuardar').onclick=()=>{
  const data={ id:editId ?? crypto.randomUUID(),
    nombre:f.nombre.value.trim(), email:f.email.value.trim(), telefono:f.telefono.value.trim(),
    servicio:f.servicio.value, inicio:f.inicio.value, vence:f.vence.value,
    categoria:f.categoria.value, notas:f.notas.value.trim(), ts:Date.now()
  };
  if(!data.nombre){ toast('Escribe un nombre'); return; }
  const arr=db.getAll(); const i=arr.findIndex(x=>x.id===data.id);
  if(i>=0) arr[i]=data; else arr.push(data);
  arr.sort((a,b)=>a.nombre.localeCompare(b.nombre)); db.saveAll(arr);
  renderTabla(); limpiar(); toast('Guardado ✓');
};

function editar(id){
  const x=db.getAll().find(c=>c.id===id); if(!x) return; editId=x.id;
  for(const k in f){ if(k in x) f[k].value=x[k]||''; }
  msg.textContent='Editando… guarda para aplicar cambios';
}
function borrar(id){
  if(!confirm('¿Eliminar este cliente?')) return;
  db.saveAll(db.getAll().filter(c=>c.id!==id)); renderTabla();
}

function coincide(x,qq){
  qq=(qq||'').trim().toLowerCase(); if(!qq) return true;
  return [x.nombre,x.email,x.servicio,x.telefono,x.categoria,x.notas]
    .some(v=>(v||'').toLowerCase().includes(qq));
}
function pasaEstado(x,f){ if(!f) return true; return estadoDe(x.vence)===f; }

function esc(s){return (s||'').replace(/[&<>"']/g,m=>({ '&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;','\'':'&#039;' }[m]))}
function fmt(iso){return iso? new Date(iso+'T00:00:00').toLocaleDateString(): '-'}

function renderTabla(){
  const arr=db.getAll(); const items=arr.filter(x=>coincide(x,q.value)&&pasaEstado(x,filterEstado.value));
  tbody.innerHTML=items.map(x=>{
    const d=diasRestantes(x.vence); const est=estadoDe(x.vence);
    const tag=est==='vigente'?'ok':est==='pronto'?'warn':'bad';
    const estTxt=est?est[0].toUpperCase()+est.slice(1):'-';
    const diasTxt= d==null?'-':(d<0?`Vencido ${Math.abs(d)} d`:`Faltan ${d} d`);
    return `<tr>
      <td>${esc(x.nombre)}</td>
      <td>${esc(x.email||'')}</td>
      <td>${esc(x.servicio||'')}</td>
      <td>${fmt(x.inicio)}</td>
      <td>${fmt(x.vence)}</td>
      <td>${est?`<span class="tag ${tag}">${estTxt}</span>`:'-'}</td>
      <td>${diasTxt}</td>
      <td>
        <button class="btn ghost" onclick="editar('${x.id}')">Editar</button>
        <button class="btn ghost" style="border-color:#fecaca;color:#7f1d1d" onclick="borrar('${x.id}')">Eliminar</button>
      </td>
    </tr>`;
  }).join('');
}
q.oninput=renderTabla; filterEstado.onchange=renderTabla;

$('#btnExportar').onclick=()=>{
  const a=document.createElement('a');
  a.href=URL.createObjectURL(new Blob([JSON.stringify(db.getAll(),null,2)],{type:'application/json'}));
  a.download='clientes.json'; a.click();
};
$('#importFile').onchange=async e=>{
  const file=e.target.files[0]; if(!file) return;
  try{ const txt=await file.text(); const data=JSON.parse(txt);
    if(!Array.isArray(data)) throw 0; db.saveAll(data); renderTabla(); toast('Importado ✓');
  }catch{ alert('Archivo no válido'); }
  e.target.value='';
};

function toast(t){ msg.textContent=t; setTimeout(()=>msg.textContent='',2500); }
renderTabla();
</script>
</body>
</html>
